Check for empty stacks in recipe component determination  
Use API versions of methods wherever possible  
Use memoizing suppliers instead of optionals for lazily initialized fields  
